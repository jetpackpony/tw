const AuthKeyExchange = require('./AuthKeyExchange/AuthKeyExchange');
const { bytesFromHex } = require('./primeFactorization');
const fs = require('fs');

const outgoing = [];
const incoming = [
  Uint8Array.from(bytesFromHex("00000000000000000158cd8f253ec85d48000000632416059ba1d40a2a65096f62de6b78078b11e5abf5346e0149569d2b9c68625916e847081ed4dea7d6888f5900000015c4b51c02000000029f4ba16d109296216be86c022bb4c3")),
  Uint8Array.from(bytesFromHex("000000000000000001982d6c263ec85d780200005c07e8d09ba1d40a2a65096f62de6b78078b11e5abf5346e0149569d2b9c68625916e847fe50020057bf254b1de78fbeba935e9a86c5cf26afafb06ee91440d0b1dbfc7aed63ec8285a415cc8f5cfc0faeb6c0a8af79eea1c63017b788681c2c64e0f279706d5ec900fd8a904513c431e4374f9242e0a38bd1c272a673141a684f76a4d1dcef678e7ba7411520cd4bc6aa707eb0dbc7047bf0bf7f6b2ceebe059598fb6faa98942b2ae6a380f2acb550475ca7cda7e415f81e0fc3eb4328cecb9d19f1d062cb2da249bfbd24beac6f5a35ab6825571e2e08f4111b8c7f9fd4e7ec2be2f8223bfae66e754b5c318a03387baf67225943428b2f06fb3ecd370a7356db2f53d9024582aa9196f9f5109c14bc25d8527d8574aae382aec77b285dae2d22410b237af68fedbae7f49c3c911c970c5744747aa9686fc1a6694b533b5b3bf759f83d1ef4f9392fcb1c0c86d3ebbe16a4d446d4e8d6afbb6986a66257e4af34c61fbc324e5873dadbf3e7641e067204bb28569184fb3b928e911a4a734ddc4789aeee8950626444f8ee3c20774b923a3947d66936785c08be6d3f25f025cae61f67c2cd56fa952e18705a2b076a6f7e0ca316a3c11f76c6a1105dfa9c6f398b761208d7dc7e3314143f86a681bd2f02f254e4e7c49432b693cee24d5b119b287fc10523d41e21ceb206d635bd58cede2968d44ddb2af14acb608c29bf90d280bf87239e6300f259882d5e58b6c7d350499e1e47d2bb55b80f858939ab6efb44bf91be9c94ae57776bfbe49feed8969290007c2a17561ec3a40ccbad55272f80c0832b3bbd1b12e98d5f95c115d56ca36478ff86bd0b1e30bea7af704e0eadf74e1ddff71adb80293c95ee8a6912ac5318bc021e0cb6")),
  Uint8Array.from(bytesFromHex("00000000000000000130760e273ec85d3400000034f7cb3b9ba1d40a2a65096f62de6b78078b11e5abf5346e0149569d2b9c68625916e847ace8426b383983d4b69182e53503b855")),
];

const exchange = new AuthKeyExchange({
  msg_id_hex: "5DC83E2500000000",
  nonce: Uint8Array.from(bytesFromHex("9ba1d40a2a65096f62de6b78078b11e5")),
  newNonce: Uint8Array.from(bytesFromHex("ded7e2d4e553d75160141371e9e34cea07b8cf79ae33301d42f2ec306c32e1a8")),
  b: Uint8Array.from(bytesFromHex("e1266c5b3cb8a6a283a78f1c282e94fb4653556ccd3fbe25e9ae59c8a8621e56c2824c152b2827e3095d6f657ea226d539ec14c01b479850a8c63c0d2f497ad02d66af17f5c1bd3724a671eaa977a6a4ff1d7f5c0d5f6d1ac416b86991b5e9fb28e6b4419476e33b2a55d95c08035ab5e3a522df0fe0c9fdffcce0d4b939526a4d7cee4c3363157e7642381ae47ee6653b17b6184f2bb8f603e568e27e8c13f7211b18cb1f7eccd70f393c25e9e02e3b297d11c7dd1e9665904ec148b0cf29758458e113d2da476b9d0fdbf4b5aee24d1c561e11441b4d103cbc693455a060a0b1085a46c4c1b47f2374b7374ae0ad158150a6948356b882f983f2ae2b996428")),
});

outgoing.push(exchange.makeNextMessage());
exchange.processMessage(incoming[0]);

outgoing.push(exchange.makeNextMessage());
exchange.processMessage(incoming[1]);

outgoing.push(exchange.makeNextMessage());
exchange.processMessage(incoming[2]);
const authResult = exchange.completeAuth();
console.log();

fs.writeFileSync('./src/authResult.json', JSON.stringify(authResult, null, 2));
